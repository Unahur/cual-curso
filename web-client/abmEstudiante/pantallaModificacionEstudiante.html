<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link type="text/css" rel="stylesheet" href="./css/abmEstudiantes.css">
    <link rel="stylesheet" href="https://servicios.unahur.edu.ar/unahur3w/_comp/unahur/img/logo-transparente.png"
        type="img/jpg" />
    <title>Estudiantes</title>



</head>

<body>
    <div>
        <p id="im">
            <img src="https://servicios.unahur.edu.ar/unahur3w/_comp/unahur/img/logo-transparente.png">
        </p>
    </div>
    <div class="modificarUsuario">
        <h2>Modificacion y Baja</h2>
    </div>
    <div id="mensaje">Modifica tus datos!
            <br>
            <strong>Podes modificar tus datos o darte de baja del sistema.</strong>
            <br>
    <div>
            <button onclick="document.getElementById('id01').style.display='block'" id= "buscar" class="botonLargo" >Buscar Estudiante</button>
            <button onclick="location.href='./pantallaEstudiante.html'">Nuevo estudiante</button>

            <!-- The Modal -->
            <div id="id01" class="modal">
              <span onclick="document.getElementById('id01').style.display='none'"
            class="close" title="Close Modal">&times;</span>
            
              <!-- Modal Content -->
              <form class="modal-content animate" id="buscarPersona">
                  <div class="container">
                    <br>
                    <label for="uname"><b>Numero de DNI</b></label>
                    <input type="text" placeholder="DNI" name="dni" id="dniIngresado">
                    <br>
                    <button id= "buscarDni" class="boton" type="click">Buscar</button>
                    <button id="cerrarModal" class="boton" type="click" onclick="document.getElementById('id01').style.display='none'">Cerrar</button>
                 </div>
             </form>
            </div>
    </div>
    <div>
            <form id="f_1" action="#" onsubmit="return false;" class="form">
                    <h3 class="toggle">Datos Personales</h3>
                    <label>Nombre y Apellido:   </label>
                    <label><input type="text" name="nombre_apellido" placeholder="Nombre y Apellido" id="nombre_apellido" required> </label>
                    <br>
                    <br>
                    <label for="uname"><b>Numero de DNI</b></label>
                    <input type="text" placeholder="DNI" name="dni" id="dniIngresado">
                    <br>
                    <input type="hidden" id="hiddenId" name="hiddenId" >
                </form>
                <br>
    <div class="botones">
        <button class="boton" onclick="modificarDatos('f_1',false);" >
            Modificar</button>
        <button  id="guardarModificacion" class="boton" type="click" onclick="modificarDatos('f_1',true); ">Guardar</button> 
        <button id= "baja" class="botonLargo" onclick="alerta()">Dar de Baja</button>
        

            </form>
        </div>
    </div>
    <div>
        <form id="f_1" action="#" onsubmit="return false;" class="form">
            <h3 class="toggle">Datos Personales</h3>
            <label>Nombre y Apellido: </label>
            <label><input type="text" name="nombre_apellido" placeholder="Nombre y Apellido" id="nombre_apellido"
                    required> </label>
            <br>
            <br>
            <label>Numero de documento: <input type="number" name="dni" placeholder="Numero DNI" id="dni"
                    required></label>
            <br>
            <input type="hidden" id="hiddenId">
        </form>
        <br>
    </div>
    <div class="botones">
        <button class="boton" onclick="modificarDatos('f_1',false);">Modificar</button>
        <button id="guardarModificacion" class="boton" type="click" onclick="modificarDatos('f_1',true); ">Guardar</button> 
        <button id= "baja" class="botonLargo" type="click" onclick="alerta()">Dar de Baja</button>

      <div>
          <label for="uname"><b>Numero de DNI</b></label>
                  <input type="text" placeholder="DNI" name="dni" id="dniIngresado">
                  <button id= "buscarDni" class="boton" type="click"> Buscar</button>
             <script>
                                var url = 'http://localhost:3001/estudiantes';
                        //var formulario = document.getElementById('buscarPersona');
                        //var persona = document.getElementsByClassName('modal-content');
                    
                        document.getElementById('buscarDni').addEventListener('click', function(){
                            console.log(" Entro al evento ");
                       
                        fetch(url, 
                            {
                                method: 'GET' 
                            }
                            ).then(res => res.json())
                           .then(dato => formatearDato(dato)) 
                           .catch(error => console.error('Error:', error))
                           .then(response => console.log('Success:', response));
                    //      .then(document.getElementById('creacionEstudiante').reset());
                        });
                    
                        function formatearDato(dato) {
                            var forDni = document.getElementById('dniIngresado').value;
                            
                            for(var i =0 ;i<dato.length;i++){ 
                                if(forDni==dato[i].dni){
                                    document.getElementById('nombre_apellido').value=dato[i].nombre_apellido;
                                    document.getElementById('dni').value=dato[i].dni;
                                    document.getElementById('hiddenId').value=dato[i].id;
                                }
                            }
                           
                        }
         </script>

         <!-- Eliminacion de estudiante por ID  -->
 
         <script>
            var url = 'http://localhost:3001/estudiantes';
        
            document.getElementById('baja').addEventListener('click', function(){
             console.log(" Entro al evento ");
             var data = {
                 dni: document.getElementById('dni').value,
                 nombre_apellido: document.getElementById('nombre_apellido').value,
             }     
             console.log(data);
             fetch(url + "/" + document.getElementById('hiddenId').value, {
                 method: 'DELETE',
                 body: JSON.stringify(data),
                 headers: {
                     'Content-Type': 'application/json'
                 }
             }).then(res => res.json())
             .catch(error => console.error('Error:', error))
             .then(response => console.log('Success:', response));
             
         });
         </script>

       </div>
  </body>

</html>